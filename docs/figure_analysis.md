# 图表解读与分析指南

> 目的：提供对 Pipeline 生成的各类图表的系统化解读方法，支持快速发现代码质量问题、稳定优势与可执行改进点。

## 目录
1. 雷达图（九维均分对比）
2. 维度棒棒糖 / 误差线图（任务内部差距分布）
3. 全局热力图（Delta + 一致性）
4. 区分性关键词条形图（Top-K）
5. 模式词云（Positive / Anti Patterns）
6. 任务级关键词词云（可选）
7. 正 / 反向模式汇总表（CSV）
8. 综合诊断流程建议
9. 常见模式与行动建议映射

---
## 1. 雷达图：九维均分对比
**文件**：`figs/global_radar.png`

### 推荐图注（可直接放入报告）
该雷达图对比了九个质量维度上 Good 与 Bad 代码的平均得分，红色（或填充）区域代表 Good 代码相对优势的包络面积。可以看到优势最显著集中在（示例：可维护性、健壮性、接口清晰度）三个维度，说明这些方面的正向范式已经比较稳定；而（示例：性能、测试覆盖）差距较小，提示要么训练样本中坏例不足，要么该维度的判别标准尚未固化。若出现某一维度 Bad 反超 Good，应优先回溯该维度的打分标准与标注质量。

### 示例分析段落
在本轮评估中，Good 代码在结构抽象、错误处理与接口语义维度形成稳定高差距（平均差值 >2 且与热力图一致性指标均为高），表明当前 Prompt 与任务构造对“清晰 API 与显式异常分支”具有良好引导作用。相反，性能与测试维度差距接近 0，结合后续关键词分布观察，这两个维度缺少足够区分性的坏例语料，后续需通过注入低效循环、去除边界断言等方式补全 Hard Negatives。

### 含义
- 每个维度两个平均值：Good 均分 vs Bad 均分。
- 阴影填充区域：Good 与 Bad 之间的差距包络，越大说明总体优势越明显。

### 关注重点
| 现象 | 可能解读 | 后续动作 |
|------|----------|----------|
| 部分维度几乎贴合 | 该维度训练/规范收益有限或数据稀疏 | 补采“坏例”或构造 Hard Negative |
| Good 明显高且稳定 | 维度成熟度高 | 总结正向范式输出团队规范 |
| Bad 反超 Good | 标注错误 / 误判 / 伪负例 | 回溯样本与打分逻辑 |
| 单一维度异常突出 | 训练/Prompt 聚焦点偏移 | 检查 Prompt 是否暗示该维度 |

### 快速判读步骤
1. 找最大差距的 2–3 个维度（优先固化最佳实践）。
2. 找最小差距甚至反超的维度（数据或标注补强）。
3. 与热力图一致性交叉验证（差距大但一致性低 → 不稳定）。

---
## 2. 维度棒棒糖 / 误差线图
**文件**：`plot_task_dimension_lollipop` 生成（单任务）

### 含义
- 每个维度：min / median / mean / max 的 delta=Good-Bad。
- 横向误差线：该任务内多个坏例的区间分布（难度散布）。

### 关注点
| 现象 | 解读 | 动作 |
|------|------|------|
| min ≈ max | 坏例同质化，缺乏多样性 | 扩充更“难”的坏例（Hard Negatives） |
| mean 与 median 偏离大 | 存在极端坏例 | 单独分析该 bad 生成来源 |
| max 远大于 mean | 好代码特性对多数坏例不敏感 | 挖掘哪些结构性特征未体现在其他坏例中 |
| 全部接近 0 | 伪任务或坏例构造失败 | 重新采集/重跑 Prompt |

### 使用建议
- 结合关键词条形图定位具体“造成高差距”的语义点。
- 抽取 delta 排名前 1–2 个 bad 进行案例剖析写入报告。

### 推荐图注
该图展示该任务下各维度的 delta 分布（Good-Bad），点表示均值（或中位）/ 误差线表示不同坏例间的离散程度。可以看到（示例：接口清晰度）维度几乎所有坏例均低于 Good，且区间紧凑，说明该维度差距稳定；而（示例：性能）维度区间跨度大，提示存在极端坏例驱动整体均值偏高，不代表普遍优势。

### 示例分析段落
本任务中“可读性”维度上下界集中（min≈max≈2.1），说明所有坏例在命名/注释/结构方面暴露出一致缺陷；“鲁棒性”维度出现一例极端坏例（max≈5.0 与 mean≈2.3 差异显著），结合原始差距 JSON 溯源，该坏例缺失异常分支和输入校验，后续可将其提炼为反模式模板，指导自动化坏例合成脚本生成更多中等严重度样本以平滑分布。

---
## 3. 全局热力图（Delta + 一致性）
**文件**：`figs/global_heatmap.png`

### 上半部分：Delta 指标
行：均值/中位/最小/最大 delta；列：九维。颜色：蓝(负)→灰(0)→红(正)。
- 红深：Good 明显领先。
- 蓝：Bad 反向更好（需警惕标注或度量）。

### 下半部分：一致性 (Consistency)
- 定义：该维度内 |Δ|≥2 的比例，衡量“明显差距出现的稳定度”。
- 高一致性 + 高均值 → 可靠优势。
- 高均值 + 低一致性 → 样本差异噪声大，需要扩充稳定坏例。

### 典型解读模式
| 组合 | 说明 | 行动 |
|------|------|------|
| (高均值, 高一致性) | 成熟优势维度 | 输出规范、固化模板 |
| (高均值, 低一致性) | 数据不稳定 | 聚焦收集边缘坏例，统一评判标准 |
| (低/负均值, 高一致性) | 系统性偏差或打分反转 | 回溯评分 / Prompt 偏向 |
| (低均值, 低一致性) | 低价值维度或噪声 | 评估是否下掉或重新定义维度 |

### 推荐图注
热力图上半部分展示九维在不同统计量（均值/中位/最小/最大）的 delta 分布，颜色越红表示 Good 优势越稳定且显著；下半部分展示各维度 |Δ|≥2 的样本占比，一致性高说明差距并非由少数极端样本驱动。本次结果中（示例：鲁棒性、可维护性）呈现“高均值+高一致性”，可直接进入规范沉淀；（示例：性能）虽平均差距为正但一致性偏低，需补充更多边界/大输入场景坏例；若出现（示例：安全）均值为负且一致性中等，应快速抽检标注与 Prompt 引导是否忽略安全要点。

### 示例分析段落
综合观察，结构抽象维度均值 delta=2.8，|Δ|≥2 占比 81%，说明 Good 样本在模块划分与职责分离上具备高度可复制特征；测试覆盖维度均值仅 0.5 且一致性 22%，当前训练未有效拉开差距。建议：1）针对低一致性但正均值的性能/边界维度，设计系统性坏例生成（如 O(n^2) 退化实现、缺失输入上限检查）；2）对负向或接近 0 且一致性不高的维度，评估是否需要重新定义指标或在 Prompt 中明确判别要点。

---
## 4. 区分性关键词条形图（Top-K）
**文件**：`plot_task_keywords_bar`（任务级） + 全局聚合表 `agg_keywords.csv`

### 指标说明
- weight = 汇总后（本任务或跨任务）关键词的加权值（由模型权重 + 差距聚合方式决定）。
- Top-K 显示“最能解释好坏差距的语义因素”。

### 解读方法
1. 观察前 5 项是否覆盖多个维度（多样性）
2. 是否存在过多“实现细节词”而缺少抽象设计词（提示 Prompt 需要强调架构层面）
3. 与模式词云交叉：高频关键词是否形成明确正/反模式句式

### 风险信号
| 现象 | 风险 | 处理 |
|------|------|------|
| 高频出现非常通用词（如“函数”） | 模型未聚焦 | 加强 Prompt 约束：要求具体化
| 全部集中于一个维度 | 评分偏斜 | 检查 9 维打分输出质量
| 出现英文长串 | 中文过滤不充分 | 增加清洗规则

### 推荐图注
条形图展示该任务（或全局）最具区分性的前 K 个关键词，其权重反映它们在拉开 Good 与 Bad 差距时的解释力。前若干关键词（示例：“显式异常处理”“输入校验”“模块边界”）与雷达图高差距维度吻合，说明评分信号语义闭环良好；若出现大量泛化词或实现细节噪声（如“代码”“调用”），需要在 Prompt 中增加“要求输出结构化、具体的设计/质量要点”约束。

### 示例分析段落
本任务前 10 关键词覆盖异常处理、边界校验、模块解耦三大主题，呈现多样性；缺失与性能优化直接相关的词汇，呼应性能维度差距不足。建议后续通过在坏例中注入低效算法片段，使“复杂度”“缓存”“批处理”等词进入 Top-K，以提升性能维度的可解释度。

---
## 5. 模式词云（Positive / Anti）
**文件**：`global_positive_patterns_wordcloud.png` / `global_anti_patterns_wordcloud.png`

### 用途
- 正向模式：应转化为团队“推荐实践”或代码模板片段。
- 反向模式：应转化为 lint 规则 / review checklist。

### 观察路径
1. 前景最大字号的 5–10 个短语是否与雷达差距维度一致。
2. Positive 中是否出现过多“泛化词”（如“规范”）；若是，需要在 Prompt 强制模型生成结构化、可执行短语。
3. Anti 中是否能分组为几类“典型坏味道”（命名/异常/重复/复杂度/安全）。

### 行动模型
| 模式类型 | 示例 | 动作 |
|----------|------|------|
| Positive | 输入校验严格 | 写进函数模板 or snippet |
| Positive | 明确异常分支 | 更新异常处理编码规范 |
| Anti | 魔法数字 | 引入常量定义检查脚本 |
| Anti | 无测试断言 | 加入 UT Gate / 静态分析钩子 |

### 推荐图注
正向模式词云突出 Good 样本中最具代表性的结构/语义实践（字号与出现频次或聚合权重相关），反向模式词云则集中展示 Bad 样本的高频缺陷主题。本次结果中正向强调（示例：“显式异常”“输入边界校验”“职责分离”），反向聚焦（示例：“重复逻辑”“魔法数字”“未捕获异常”），与热力图高差距维度形成互证，为规范提炼与 lint 规则扩展提供直接素材。

### 示例分析段落
经过聚合，Positive 模式前 5 均指向结构化与防御性编程实践，说明模型区分度主要来源于接口与异常设计；Anti 模式则在命名与重复逻辑上高度集中，显示当前坏例构造尚未充分覆盖并发与性能退化场景。下一步可在坏例池加入：1）故意缺失资源释放；2）竞争条件；3）低效数据结构使用，以拓宽负向模式谱系。

---
## 6. 任务级关键词词云（可选）
- 用于快速定位单任务里 Good 优势最强的“语义标签”。
- 与棒棒糖图结合：挑出 delta 大的维度，再看对应关键词是否在本任务词云内高频。
- 可作为报告“案例”小节的截图材料。

### 推荐图注
该词云展示单一任务中 Good 样本优势最突出的语义标签，字号与聚合权重相关。与同任务棒棒糖图对比，可验证贡献最大差距的维度是否在语义层面得到支撑；缺失某维度关联词汇可能意味着当前评分提示语未充分引导该维度语言特征显性化。

### 示例分析段落
在任务 A 中，词云突出“输入校验”“空值处理”“异常包装”，与该任务在鲁棒性与接口清晰度维度上高 delta 一致；但未出现“性能”相关术语，佐证该维度差距低。建议通过坏例注入（如 O(n^2) 循环、未使用缓存）让性能相关词进入前列，以便后续度量更易区分。

---
## 7. 正 / 反向模式汇总表（CSV）
**文件**：`agg_positive_patterns.csv` / `agg_anti_patterns.csv`

列含义：
- pattern：模式短语（已做中文过滤）
- count：出现次数（任务级 positive 按任务计 1；anti 按 bad 分布）
- task_count：覆盖的任务数

解读：
- 高 count + 高 task_count：广泛、稳定的结构性差异（优先入规范）
- 高 count + 低 task_count：局部集中问题（针对性专项治理）
- 低 count + 高 task_count：弱信号或表达稀释（可进一步合并同义）

### 推荐图注
该表总结全局正/反向模式的出现频次与任务覆盖度：高频且高覆盖的正向模式应优先转化为标准化模板；高频低覆盖的反向模式代表局部深度缺陷，可定向做专项修复；低频高覆盖的模式往往语义稀释，需考虑同义归并或加强 Prompt 约束提升表达集中度。

### 示例分析段落
当前“显式异常处理”“输入参数校验”两类正向模式覆盖 87% 的任务且频次最高，适合直接抽取代码片段形成团队最佳实践；反向模式中“魔法数字”虽然总频次高但集中在少数任务，说明这些任务的坏例生成策略偏向硬编码缺陷，建议扩展到资源泄漏、并发竞争等更广泛缺陷类型以避免数据分布失衡。

---
## 8. 综合诊断流程建议
1. 看热力图：找“高差距 + 高一致性”与“潜在异常”维度
2. 看雷达图：验证差距整体轮廓，列出 Top 3 优势维度
3. 看正/反模式词云：抽象为 5–10 条“团队实践 & 反模式”
4. 看关键词条形图：核对是否有遗漏的重要语义点
5. 深入 1 个典型任务：棒棒糖 + 任务词云 + 原始差距 JSON
6. 输出行动项：规范更新 / 监控指标 / 自动化脚本

---
## 9. 常见模式与行动建议映射
| 观察信号 | 根因可能 | 建议动作 |
|-----------|----------|----------|
| 复杂度维度差距大且一致性高 | 好代码结构抽象好 | 抽取“模块划分/单一职责”规范示例 |
| 测试维度差距低 | 数据缺少测试相关坏例 | 人工构造去除断言/缺少边界测试的坏例 |
| 安全/依赖差距低 | Prompt 未强调安全 | 在 Prompt 中加入“列出依赖与风险点”引导 |
| 性能维度高差距但一致性低 | 个别极端坏例 | 自动生成中等难度性能坏例（劣化算法） |
| Positive 模式含模糊词 | 输出约束不严 | 强制“模式=动宾短语+具体对象”描述模板 |
| Anti 模式重复 | 坏例类型单一 | 增加多类型缺陷注入（命名/异常/并发/安全） |

---
## 附：快速问题定位 Checklist
- 哪 3 个维度最值得写规范？
- 哪 2 个维度数据最不稳定（高差距低一致性）？
- 是否存在 Bad 反超的维度？
- Positive 前 10 中是否有可直接产品化的“自动生成脚本”？
- Anti 前 10 是否可映射到已有 lint 规则？若无，需要新增哪些？

---
如需：
- 自动生成“报告草稿”Markdown 片段
- 把这些分析转为 docx / PDF
- 对 CSV 进行自动诊断输出（脚本）
请告诉我，我可以继续补充。
