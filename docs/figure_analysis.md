# 图表解读与分析指南

> 目的：提供对 Pipeline 生成的各类图表的系统化解读方法，支持快速发现代码质量问题、稳定优势与可执行改进点。

## 目录
1. 雷达图（九维均分对比）
2. 维度棒棒糖 / 误差线图（任务内部差距分布）
3. 全局热力图（Delta + 一致性）
4. 区分性关键词条形图（Top-K）
5. 模式词云（Positive / Anti Patterns）
6. 任务级关键词词云（可选）
7. 正 / 反向模式汇总表（CSV）
8. 综合诊断流程建议
9. 常见模式与行动建议映射

---
## 1. 雷达图：九维均分对比
**文件**：`figs/global_radar.png`

### 含义
- 每个维度两个平均值：Good 均分 vs Bad 均分。
- 阴影填充区域：Good 与 Bad 之间的差距包络，越大说明总体优势越明显。

### 关注重点
| 现象 | 可能解读 | 后续动作 |
|------|----------|----------|
| 部分维度几乎贴合 | 该维度训练/规范收益有限或数据稀疏 | 补采“坏例”或构造 Hard Negative |
| Good 明显高且稳定 | 维度成熟度高 | 总结正向范式输出团队规范 |
| Bad 反超 Good | 标注错误 / 误判 / 伪负例 | 回溯样本与打分逻辑 |
| 单一维度异常突出 | 训练/Prompt 聚焦点偏移 | 检查 Prompt 是否暗示该维度 |

### 快速判读步骤
1. 找最大差距的 2–3 个维度（优先固化最佳实践）。
2. 找最小差距甚至反超的维度（数据或标注补强）。
3. 与热力图一致性交叉验证（差距大但一致性低 → 不稳定）。

---
## 2. 维度棒棒糖 / 误差线图
**文件**：`plot_task_dimension_lollipop` 生成（单任务）

### 含义
- 每个维度：min / median / mean / max 的 delta=Good-Bad。
- 横向误差线：该任务内多个坏例的区间分布（难度散布）。

### 关注点
| 现象 | 解读 | 动作 |
|------|------|------|
| min ≈ max | 坏例同质化，缺乏多样性 | 扩充更“难”的坏例（Hard Negatives） |
| mean 与 median 偏离大 | 存在极端坏例 | 单独分析该 bad 生成来源 |
| max 远大于 mean | 好代码特性对多数坏例不敏感 | 挖掘哪些结构性特征未体现在其他坏例中 |
| 全部接近 0 | 伪任务或坏例构造失败 | 重新采集/重跑 Prompt |

### 使用建议
- 结合关键词条形图定位具体“造成高差距”的语义点。
- 抽取 delta 排名前 1–2 个 bad 进行案例剖析写入报告。

---
## 3. 全局热力图（Delta + 一致性）
**文件**：`figs/global_heatmap.png`

### 上半部分：Delta 指标
行：均值/中位/最小/最大 delta；列：九维。颜色：蓝(负)→灰(0)→红(正)。
- 红深：Good 明显领先。
- 蓝：Bad 反向更好（需警惕标注或度量）。

### 下半部分：一致性 (Consistency)
- 定义：该维度内 |Δ|≥2 的比例，衡量“明显差距出现的稳定度”。
- 高一致性 + 高均值 → 可靠优势。
- 高均值 + 低一致性 → 样本差异噪声大，需要扩充稳定坏例。

### 典型解读模式
| 组合 | 说明 | 行动 |
|------|------|------|
| (高均值, 高一致性) | 成熟优势维度 | 输出规范、固化模板 |
| (高均值, 低一致性) | 数据不稳定 | 聚焦收集边缘坏例，统一评判标准 |
| (低/负均值, 高一致性) | 系统性偏差或打分反转 | 回溯评分 / Prompt 偏向 |
| (低均值, 低一致性) | 低价值维度或噪声 | 评估是否下掉或重新定义维度 |

---
## 4. 区分性关键词条形图（Top-K）
**文件**：`plot_task_keywords_bar`（任务级） + 全局聚合表 `agg_keywords.csv`

### 指标说明
- weight = 汇总后（本任务或跨任务）关键词的加权值（由模型权重 + 差距聚合方式决定）。
- Top-K 显示“最能解释好坏差距的语义因素”。

### 解读方法
1. 观察前 5 项是否覆盖多个维度（多样性）
2. 是否存在过多“实现细节词”而缺少抽象设计词（提示 Prompt 需要强调架构层面）
3. 与模式词云交叉：高频关键词是否形成明确正/反模式句式

### 风险信号
| 现象 | 风险 | 处理 |
|------|------|------|
| 高频出现非常通用词（如“函数”） | 模型未聚焦 | 加强 Prompt 约束：要求具体化
| 全部集中于一个维度 | 评分偏斜 | 检查 9 维打分输出质量
| 出现英文长串 | 中文过滤不充分 | 增加清洗规则

---
## 5. 模式词云（Positive / Anti）
**文件**：`global_positive_patterns_wordcloud.png` / `global_anti_patterns_wordcloud.png`

### 用途
- 正向模式：应转化为团队“推荐实践”或代码模板片段。
- 反向模式：应转化为 lint 规则 / review checklist。

### 观察路径
1. 前景最大字号的 5–10 个短语是否与雷达差距维度一致。
2. Positive 中是否出现过多“泛化词”（如“规范”）；若是，需要在 Prompt 强制模型生成结构化、可执行短语。
3. Anti 中是否能分组为几类“典型坏味道”（命名/异常/重复/复杂度/安全）。

### 行动模型
| 模式类型 | 示例 | 动作 |
|----------|------|------|
| Positive | 输入校验严格 | 写进函数模板 or snippet |
| Positive | 明确异常分支 | 更新异常处理编码规范 |
| Anti | 魔法数字 | 引入常量定义检查脚本 |
| Anti | 无测试断言 | 加入 UT Gate / 静态分析钩子 |

---
## 6. 任务级关键词词云（可选）
- 用于快速定位单任务里 Good 优势最强的“语义标签”。
- 与棒棒糖图结合：挑出 delta 大的维度，再看对应关键词是否在本任务词云内高频。
- 可作为报告“案例”小节的截图材料。

---
## 7. 正 / 反向模式汇总表（CSV）
**文件**：`agg_positive_patterns.csv` / `agg_anti_patterns.csv`

列含义：
- pattern：模式短语（已做中文过滤）
- count：出现次数（任务级 positive 按任务计 1；anti 按 bad 分布）
- task_count：覆盖的任务数

解读：
- 高 count + 高 task_count：广泛、稳定的结构性差异（优先入规范）
- 高 count + 低 task_count：局部集中问题（针对性专项治理）
- 低 count + 高 task_count：弱信号或表达稀释（可进一步合并同义）

---
## 8. 综合诊断流程建议
1. 看热力图：找“高差距 + 高一致性”与“潜在异常”维度
2. 看雷达图：验证差距整体轮廓，列出 Top 3 优势维度
3. 看正/反模式词云：抽象为 5–10 条“团队实践 & 反模式”
4. 看关键词条形图：核对是否有遗漏的重要语义点
5. 深入 1 个典型任务：棒棒糖 + 任务词云 + 原始差距 JSON
6. 输出行动项：规范更新 / 监控指标 / 自动化脚本

---
## 9. 常见模式与行动建议映射
| 观察信号 | 根因可能 | 建议动作 |
|-----------|----------|----------|
| 复杂度维度差距大且一致性高 | 好代码结构抽象好 | 抽取“模块划分/单一职责”规范示例 |
| 测试维度差距低 | 数据缺少测试相关坏例 | 人工构造去除断言/缺少边界测试的坏例 |
| 安全/依赖差距低 | Prompt 未强调安全 | 在 Prompt 中加入“列出依赖与风险点”引导 |
| 性能维度高差距但一致性低 | 个别极端坏例 | 自动生成中等难度性能坏例（劣化算法） |
| Positive 模式含模糊词 | 输出约束不严 | 强制“模式=动宾短语+具体对象”描述模板 |
| Anti 模式重复 | 坏例类型单一 | 增加多类型缺陷注入（命名/异常/并发/安全） |

---
## 附：快速问题定位 Checklist
- 哪 3 个维度最值得写规范？
- 哪 2 个维度数据最不稳定（高差距低一致性）？
- 是否存在 Bad 反超的维度？
- Positive 前 10 中是否有可直接产品化的“自动生成脚本”？
- Anti 前 10 是否可映射到已有 lint 规则？若无，需要新增哪些？

---
如需：
- 自动生成“报告草稿”Markdown 片段
- 把这些分析转为 docx / PDF
- 对 CSV 进行自动诊断输出（脚本）
请告诉我，我可以继续补充。
